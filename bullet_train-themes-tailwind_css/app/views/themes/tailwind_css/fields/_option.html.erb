<%
form ||= current_fields_form
labels = labels_for(form, method) if form

# Initialize options.
# `options` is initialized in `_options` too,
# but `_option` can also be rendered by itself.
# In that case, we need to initialize options here.
# If `_option` is being called from `_options`,
# we assume `option_field_options` has already been
# declared there, so we don't initialize it here.
options ||= {}

single_check_box ||= false
multiple ||= false
append_class ||= ''

# Since we don't know at this point which tag we'll be using, we specify
# the class only once here for simplicity and apply it to one of the following tags:
# 1. form.check_box
# 2. check_box
# 4. form.radio_button
#
# the `append_class` local can be used to append any other styles desired for the element.
options[:class] ||= "focus:ring-primary-500 h-4 w-4 text-primary-500 border-slate-300 dark:bg-slate-800 dark:border-slate-900 #{"rounded" if multiple || single_check_box}"
options[:class] += " #{append_class}"
%>

<% if single_check_box %>
  <% if form %>
    <div class="flex items-center">
      <%= form.check_box method, options %>
      <%= form.label method, class: 'ml-2' %>
    </div>
  <% else %>
    <% value = options.delete(:value) %>
    <% checked = options.delete(:checked) %>
    <%= check_box_tag method, value, checked, options %>
  <% end %>
<% else %>
  <% option_field_options.each do |value, label| %>
    <label class="relative flex items-start mb-3">
      <div class="flex items-center h-5">
        <% if multiple %>
          <% checked_value = form.object.send(method).nil? ? nil : form.object.send(method).map(&:to_s).include?(value.to_s) %>
          <%= form.check_box method, {
            multiple: multiple, checked: checked_value, **options
          }, value, "" %>
        <% else %>
          <%= form.radio_button method, value, **options %>
        <% end %>
      </div>
      <div class="ml-2.5 text-sm">
        <div class="select-none"><%= label %></div>
        <% if labels.options_help&.dig(value)&.present? %>
          <p class="mt-0.5 text-xs text-slate-500">
            <%= labels.options_help.dig(value) %>
          </p>
        <% end %>
      </div>
    </label>
  <% end %>
<% end %>
